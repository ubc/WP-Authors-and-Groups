{"version":3,"file":"block-filters.js","mappings":"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","sources":["webpack://wp-authors-and-groups/external window [\"wp\",\"serverSideRender\"]","webpack://wp-authors-and-groups/external window \"ReactJSXRuntime\"","webpack://wp-authors-and-groups/webpack/bootstrap","webpack://wp-authors-and-groups/webpack/runtime/compat get default export","webpack://wp-authors-and-groups/webpack/runtime/define property getters","webpack://wp-authors-and-groups/webpack/runtime/hasOwnProperty shorthand","webpack://wp-authors-and-groups/webpack/runtime/make namespace object","webpack://wp-authors-and-groups/./js/block-filters.js"],"sourcesContent":["module.exports = window[\"wp\"][\"serverSideRender\"];","module.exports = window[\"ReactJSXRuntime\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * WordPress Authors and Groups Query Loop Filter Extension\n *\n * Extends the Query Loop block to add an author filter that works with\n * the wp-author-groups plugin's custom meta fields.\n *\n * @package wp-authors-and-groups\n */\n\nimport ServerSideRender from '@wordpress/server-side-render';\n\nconst { addFilter } = wp.hooks;\nconst { PanelBody, SelectControl } = wp.components;\nconst { InspectorControls, useBlockProps } = wp.blockEditor;\nconst { __ } = wp.i18n;\nconst { useEffect, useState, useMemo } = wp.element;\nconst apiFetch = wp.apiFetch;\n\n/**\n * Adds the author filter control to Query Loop blocks.\n *\n * @param {Object} BlockEdit Original block edit component.\n * @return {Object} Enhanced block edit component with author filter.\n */\nconst withAuthorFilterOnQueryLoop = (BlockEdit) => {\n\treturn (props) => {\n\t\tconst { attributes, setAttributes, name } = props;\n\n\t\t// Only apply to Query Loop block\n\t\tif (name !== 'core/query') {\n\t\t\treturn <BlockEdit {...props} />;\n\t\t}\n\n\t\t// Get query from attributes (Query Loop blocks store query in attributes.query)\n\t\tconst queryContext = attributes?.query || {};\n\n\t\t// State for users and groups\n\t\tconst [users, setUsers] = useState([]);\n\t\tconst [userGroups, setUserGroups] = useState([]);\n\t\tconst [isLoading, setIsLoading] = useState(true);\n\n\t\t// Fetch users and groups on mount\n\t\tuseEffect(() => {\n\t\t\tconst fetchData = async () => {\n\t\t\t\ttry {\n\t\t\t\t\t// Fetch users\n\t\t\t\t\tconst fetchedUsers = await apiFetch({\n\t\t\t\t\t\tpath: '/wp/v2/users?per_page=100&orderby=name&order=asc',\n\t\t\t\t\t});\n\n\t\t\t\t\t// Fetch user groups\n\t\t\t\t\tconst fetchedGroups = await apiFetch({\n\t\t\t\t\t\tpath: '/wp-authors-and-groups/v1/user-groups',\n\t\t\t\t\t});\n\n\t\t\t\t\tsetUsers(Array.isArray(fetchedUsers) ? fetchedUsers : []);\n\t\t\t\t\tsetUserGroups(Array.isArray(fetchedGroups) ? fetchedGroups : []);\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Error fetching users/groups:', error);\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfetchData();\n\t\t}, []);\n\n\t\t// Prepare options for the select control\n\t\tconst filterOptions = useMemo(() => {\n\t\t\tconst options = [\n\t\t\t\t{ label: __('All Authors', 'wp-authors-and-groups'), value: '' },\n\t\t\t];\n\n\t\t\t// Add user groups first\n\t\t\tuserGroups.forEach((group) => {\n\t\t\t\toptions.push({\n\t\t\t\t\tlabel: `${group.name} (${__('Group', 'wp-authors-and-groups')})`,\n\t\t\t\t\tvalue: `group-${group.id}`,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Add individual users\n\t\t\tusers.forEach((user) => {\n\t\t\t\toptions.push({\n\t\t\t\t\tlabel: user.name,\n\t\t\t\t\tvalue: `user-${user.id}`,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn options;\n\t\t}, [users, userGroups]);\n\n\t\t// Get current filter value\n\t\tconst currentFilter = queryContext.wpAuthorsAndGroupsFilter || '';\n\n\t\t// Handle filter change\n\t\tconst handleFilterChange = (value) => {\n\t\t\tconst newQuery = {\n\t\t\t\t...queryContext,\n\t\t\t\twpAuthorsAndGroupsFilter: value || undefined,\n\t\t\t};\n\n\t\t\t// Remove the property if empty to keep attributes clean\n\t\t\tif (!value) {\n\t\t\t\tdelete newQuery.wpAuthorsAndGroupsFilter;\n\t\t\t}\n\n\t\t\tsetAttributes({\n\t\t\t\tquery: newQuery,\n\t\t\t});\n\t\t};\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<BlockEdit {...props} />\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody\n\t\t\t\t\t\ttitle={__('Authors and Groups Filter', 'wp-authors-and-groups')}\n\t\t\t\t\t\tinitialOpen={false}\n\t\t\t\t\t>\n\t\t\t\t\t\t{isLoading ? (\n\t\t\t\t\t\t\t<p>{__('Loading...', 'wp-authors-and-groups')}</p>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\t\tlabel={__('Filter by Author or Group', 'wp-authors-and-groups')}\n\t\t\t\t\t\t\t\tvalue={currentFilter}\n\t\t\t\t\t\t\t\toptions={filterOptions}\n\t\t\t\t\t\t\t\tonChange={handleFilterChange}\n\t\t\t\t\t\t\t\thelp={__(\n\t\t\t\t\t\t\t\t\t'Filter posts by specific authors or user groups assigned via the Authors and Groups plugin.',\n\t\t\t\t\t\t\t\t\t'wp-authors-and-groups'\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t</>\n\t\t);\n\t};\n};\n\n// Register the filter\naddFilter(\n\t'editor.BlockEdit',\n\t'wp-authors-and-groups/query-loop-filter',\n\twithAuthorFilterOnQueryLoop\n);\n\n/**\n * Forces some of the core blocks to render on the server.\n *\n * @param {Object} BlockEdit Original block edit component.\n * @return {Object} Enhanced block edit component with author filter.\n */\nconst withForceServerRender = (BlockEdit) => {\n\treturn (props) => {\n\t\tconst { name, attributes } = props;\n\n\t\t// Only apply to Post Author block\n\t\tif (name !== 'core/post-author') {\n\t\t\treturn <BlockEdit {...props} />;\n\t\t}\n\n\t\tconst blockProps = useBlockProps();\n\n\t\treturn (\n\t\t\t<div {...blockProps}>\n\t\t\t\t<ServerSideRender\n\t\t\t\t\tblock=\"core/post-author\"\n\t\t\t\t\tattributes={attributes}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t};\n};\n\n// Register the filter\naddFilter(\n\t'editor.BlockEdit',\n\t'wp-authors-and-groups/force-server-render',\n\twithForceServerRender\n);\n"],"names":["ServerSideRender","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","addFilter","wp","hooks","PanelBody","SelectControl","components","InspectorControls","useBlockProps","blockEditor","__","i18n","useEffect","useState","useMemo","element","apiFetch","withAuthorFilterOnQueryLoop","BlockEdit","props","attributes","setAttributes","name","queryContext","query","users","setUsers","userGroups","setUserGroups","isLoading","setIsLoading","fetchData","fetchedUsers","path","fetchedGroups","Array","isArray","error","console","filterOptions","options","label","value","forEach","group","push","id","user","currentFilter","wpAuthorsAndGroupsFilter","handleFilterChange","newQuery","undefined","children","title","initialOpen","onChange","help","withForceServerRender","blockProps","block"],"ignoreList":[],"sourceRoot":""}